{
   "description": "PostgreSQL monitoring dashboard for DBAs.\n\nTiers:\n- Health: At-a-glance status (always visible)\n- Problems: Issues needing attention\n- Performance: Throughput and resource trends\n- Maintenance: Vacuum, bloat, and capacity planning\n- Settings: PostgreSQL configuration parameters\n",
   "links": [
      {
         "asDropdown": false,
         "includeVars": true,
         "keepTime": true,
         "tags": [
            "postgres",
            "database"
         ],
         "title": "All PostgreSQL dashboards",
         "type": "dashboards"
      }
   ],
   "panels": [
      {
         "collapsed": false,
         "gridPos": {
            "h": 1,
            "w": 0,
            "x": 0,
            "y": 0
         },
         "panels": [ ],
         "title": "Health",
         "type": "row"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Whether PostgreSQL is up and accepting connections.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "mappings": [
                  {
                     "options": {
                        "0": {
                           "color": "red",
                           "index": 0,
                           "text": "DOWN"
                        },
                        "1": {
                           "color": "green",
                           "index": 1,
                           "text": "UP"
                        }
                     },
                     "type": "value"
                  }
               ],
               "thresholds": {
                  "steps": [
                     {
                        "color": "red",
                        "value": 0
                     },
                     {
                        "color": "green",
                        "value": 1
                     }
                  ]
               }
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "PostgreSQL status"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 4,
            "x": 0,
            "y": 1
         },
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  pg_up{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: PostgreSQL status",
               "refId": "PostgreSQL status"
            }
         ],
         "title": "PostgreSQL status",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Time since PostgreSQL server started.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "red",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 300
                     },
                     {
                        "color": "green",
                        "value": 3600
                     }
                  ]
               },
               "unit": "dtdurations"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Uptime"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "s"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 4,
            "x": 4,
            "y": 1
         },
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  time() - pg_postmaster_start_time_seconds{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Uptime",
               "refId": "Uptime"
            }
         ],
         "title": "Uptime",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Whether this node is a replica (1) or primary (0).",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "fixed"
               },
               "mappings": [
                  {
                     "options": {
                        "0": {
                           "color": "blue",
                           "index": 0,
                           "text": "PRIMARY"
                        },
                        "1": {
                           "color": "purple",
                           "index": 1,
                           "text": "REPLICA"
                        }
                     },
                     "type": "value"
                  }
               ]
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Node role"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 4,
            "x": 8,
            "y": 1
         },
         "options": {
            "colorMode": "fixed",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  pg_replication_is_replica{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Node role",
               "refId": "Node role"
            }
         ],
         "title": "Node role",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Percentage of max_connections in use. Above 80% is warning, above 95% is critical.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 0.69999999999999996
                     },
                     {
                        "color": "orange",
                        "value": 0.84999999999999998
                     },
                     {
                        "color": "red",
                        "value": 0.94999999999999996
                     }
                  ]
               },
               "unit": "percentunit"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Connection utilization"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "percentunit"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 4,
            "x": 12,
            "y": 1
         },
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  sum by (job,cluster,instance) (pg_stat_activity_count{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n/\nmax by (job,cluster,instance) (pg_settings_max_connections{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Connection utilization",
               "refId": "Connection utilization"
            }
         ],
         "title": "Connection utilization",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Percentage of reads served from shared_buffers cache. Should be >95%.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "red",
                        "value": 0
                     },
                     {
                        "color": "orange",
                        "value": 0.80000000000000004
                     },
                     {
                        "color": "yellow",
                        "value": 0.90000000000000002
                     },
                     {
                        "color": "green",
                        "value": 0.94999999999999996
                     }
                  ]
               },
               "unit": "percentunit"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Cache hit ratio"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "percentunit"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 4,
            "x": 16,
            "y": 1
         },
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  sum by (job,cluster,instance) (pg_stat_database_blks_hit{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n/\n(\n  sum by (job,cluster,instance) (pg_stat_database_blks_hit{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n  +\n  sum by (job,cluster,instance) (pg_stat_database_blks_read{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n)\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Cache hit ratio",
               "refId": "Cache hit ratio"
            }
         ],
         "title": "Cache hit ratio",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Total deadlocks detected. Any deadlocks indicate contention problems.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "red",
                        "value": 1
                     }
                  ]
               }
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Deadlocks"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 4,
            "x": 20,
            "y": 1
         },
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "diff"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_database_deadlocks{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Deadlocks",
               "refId": "Deadlocks"
            }
         ],
         "title": "Deadlocks",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Replication lag in seconds. High values indicate replica is behind.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 5
                     },
                     {
                        "color": "orange",
                        "value": 30
                     },
                     {
                        "color": "red",
                        "value": 60
                     }
                  ]
               },
               "unit": "s"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Replication lag"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "s"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 8,
            "x": 0,
            "y": 5
         },
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "max by (job,cluster,instance) (\n  pg_replication_lag_seconds{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Replication lag",
               "refId": "Replication lag"
            }
         ],
         "title": "Replication lag",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Number of replicas connected to this primary.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "yellow",
                        "value": 0
                     },
                     {
                        "color": "green",
                        "value": 1
                     }
                  ]
               }
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Connected replicas"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 8,
            "x": 8,
            "y": 5
         },
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "count by (job,cluster,instance) (\n  pg_stat_replication_pg_wal_lsn_diff{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Connected replicas",
               "refId": "Connected replicas"
            }
         ],
         "title": "Connected replicas",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "WAL bytes not yet consumed by replication slots. High values indicate slow replicas or unused slots.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 10485760
                     },
                     {
                        "color": "orange",
                        "value": 104857600
                     },
                     {
                        "color": "red",
                        "value": 1073741824
                     }
                  ]
               },
               "unit": "bytes"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Replication slot lag"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "bytes"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 8,
            "x": 16,
            "y": 5
         },
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "max by (job,cluster,instance) (\n  pg_stat_replication_pg_wal_lsn_diff{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Replication slot lag",
               "refId": "Replication slot lag"
            }
         ],
         "title": "Replication slot lag",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Percentage of max_connections in use. Above 80% is warning, above 95% is critical.",
         "fieldConfig": {
            "defaults": {
               "max": 1,
               "min": 0,
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 0.69999999999999996
                     },
                     {
                        "color": "orange",
                        "value": 0.84999999999999998
                     },
                     {
                        "color": "red",
                        "value": 0.94999999999999996
                     }
                  ]
               },
               "unit": "percentunit"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Connection utilization"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "percentunit"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 6,
            "w": 12,
            "x": 0,
            "y": 11
         },
         "options": {
            "minVizHeight": 200,
            "minVizWidth": 200,
            "showThresholdLabels": false
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  sum by (job,cluster,instance) (pg_stat_activity_count{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n/\nmax by (job,cluster,instance) (pg_settings_max_connections{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Connection utilization",
               "refId": "Connection utilization"
            }
         ],
         "title": "Connection utilization",
         "type": "gauge"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Percentage of reads served from shared_buffers cache. Should be >95%.",
         "fieldConfig": {
            "defaults": {
               "max": 1,
               "min": 0,
               "thresholds": {
                  "steps": [
                     {
                        "color": "red",
                        "value": 0
                     },
                     {
                        "color": "orange",
                        "value": 0.80000000000000004
                     },
                     {
                        "color": "yellow",
                        "value": 0.90000000000000002
                     },
                     {
                        "color": "green",
                        "value": 0.94999999999999996
                     }
                  ]
               },
               "unit": "percentunit"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Cache hit ratio"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "percentunit"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 6,
            "w": 12,
            "x": 12,
            "y": 11
         },
         "options": {
            "minVizHeight": 200,
            "minVizWidth": 200,
            "showThresholdLabels": false
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  sum by (job,cluster,instance) (pg_stat_database_blks_hit{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n/\n(\n  sum by (job,cluster,instance) (pg_stat_database_blks_hit{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n  +\n  sum by (job,cluster,instance) (pg_stat_database_blks_read{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n)\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Cache hit ratio",
               "refId": "Cache hit ratio"
            }
         ],
         "title": "Cache hit ratio",
         "type": "gauge"
      },
      {
         "collapsed": false,
         "gridPos": {
            "h": 1,
            "w": 0,
            "x": 0,
            "y": 17
         },
         "panels": [ ],
         "title": "Active Problems",
         "type": "row"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Queries running longer than 5 minutes. Check pg_stat_activity for details.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 1
                     },
                     {
                        "color": "red",
                        "value": 3
                     }
                  ]
               }
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Long-running queries"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 6,
            "w": 8,
            "x": 0,
            "y": 18
         },
         "options": {
            "colorMode": "value",
            "graphMode": "area",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  count(pg_stat_activity_max_tx_duration{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\", state=\"active\"} > 300) by (job,cluster,instance)\nor vector(0)\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Long-running queries",
               "refId": "Long-running queries"
            }
         ],
         "title": "Long-running queries",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Queries waiting for locks. Indicates lock contention.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 1
                     },
                     {
                        "color": "red",
                        "value": 5
                     }
                  ]
               }
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Blocked queries"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 6,
            "w": 8,
            "x": 8,
            "y": 18
         },
         "options": {
            "colorMode": "value",
            "graphMode": "area",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  pg_locks_count{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\", mode=\"ExclusiveLock\"}\nor vector(0)\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Blocked queries",
               "refId": "Blocked queries"
            }
         ],
         "title": "Blocked queries",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Connections idle in transaction. Can hold locks and block others.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 5
                     },
                     {
                        "color": "red",
                        "value": 20
                     }
                  ]
               }
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Idle in transaction"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 6,
            "w": 8,
            "x": 16,
            "y": 18
         },
         "options": {
            "colorMode": "value",
            "graphMode": "area",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  pg_stat_activity_count{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\", state=\"idle in transaction\"}\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Idle in transaction",
               "refId": "Idle in transaction"
            }
         ],
         "title": "Idle in transaction",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "WAL archive failures. Non-zero indicates backup problems!",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "red",
                        "value": 1
                     }
                  ]
               }
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "WAL archive failures"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 6,
            "w": 8,
            "x": 0,
            "y": 24
         },
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "diff"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_archiver_failed_count{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: WAL archive failures",
               "refId": "WAL archive failures"
            }
         ],
         "title": "WAL archive failures",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Times bgwriter stopped due to writing too many buffers. Indicates I/O pressure.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 0.01
                     },
                     {
                        "color": "red",
                        "value": 0.10000000000000001
                     }
                  ]
               },
               "unit": "ops"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Bgwriter max written clean"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 6,
            "w": 8,
            "x": 8,
            "y": 24
         },
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_bgwriter_maxwritten_clean_total{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Max written clean",
               "refId": "Bgwriter max written clean"
            }
         ],
         "title": "Bgwriter max written clean",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Lock utilization as percentage of max_locks_per_transaction * max_connections.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "mode": "thresholds"
               },
               "max": 1,
               "min": 0,
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 0.050000000000000003
                     },
                     {
                        "color": "orange",
                        "value": 0.10000000000000001
                     },
                     {
                        "color": "red",
                        "value": 0.20000000000000001
                     }
                  ]
               },
               "unit": "percentunit"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Lock utilization"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "percentunit"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 6,
            "w": 8,
            "x": 16,
            "y": 24
         },
         "options": {
            "minVizHeight": 200,
            "minVizWidth": 200,
            "showThresholdLabels": false
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  sum by (job,cluster,instance) (pg_locks_count{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n/\n(\n  max by (job,cluster,instance) (pg_settings_max_locks_per_transaction{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n  *\n  max by (job,cluster,instance) (pg_settings_max_connections{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n)\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Lock utilization",
               "refId": "Lock utilization"
            }
         ],
         "title": "Lock utilization",
         "type": "gauge"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Inactive replication slots. Can cause WAL to accumulate and fill disk!",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "red",
                        "value": 1
                     }
                  ]
               }
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Inactive replication slots"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 6,
            "w": 8,
            "x": 0,
            "y": 30
         },
         "options": {
            "colorMode": "value",
            "graphMode": "area",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  count by (job,cluster,instance) (pg_stat_replication_pg_wal_lsn_diff{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\", state!=\"streaming\"})\nor\n(0 * group by (job,cluster,instance) (pg_stat_replication_pg_wal_lsn_diff{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}))\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Inactive replication slots",
               "refId": "Inactive replication slots"
            }
         ],
         "title": "Inactive replication slots",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "PostgreSQL exporter scrape errors.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "red",
                        "value": 1
                     }
                  ]
               }
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Exporter errors"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 6,
            "w": 8,
            "x": 8,
            "y": 30
         },
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  pg_exporter_last_scrape_error{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Exporter errors",
               "refId": "Exporter errors"
            }
         ],
         "title": "Exporter errors",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "description": "Deadlocks and conflicts (replica recovery cancellations).",
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 30,
                  "gradientMode": "opacity",
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "showPoints": "never"
               },
               "unit": "short"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Deadlocks"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Conflicts"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 6,
            "w": 8,
            "x": 16,
            "y": 30
         },
         "options": {
            "legend": {
               "calcs": [ ],
               "displayMode": "list"
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_database_deadlocks{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Deadlocks",
               "refId": "Deadlocks"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  pg_stat_database_conflicts{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Conflicts",
               "refId": "Conflicts"
            }
         ],
         "title": "Conflicts / Deadlocks",
         "type": "timeseries"
      },
      {
         "collapsed": false,
         "gridPos": {
            "h": 1,
            "w": 0,
            "x": 0,
            "y": 36
         },
         "panels": [ ],
         "title": "Performance Trends",
         "type": "row"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Combined commits and rollbacks per second.",
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 30,
                  "gradientMode": "opacity",
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "showPoints": "never"
               },
               "unit": "ops"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Transactions per second"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "ops"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 37
         },
         "options": {
            "legend": {
               "calcs": [ ],
               "displayMode": "list"
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_database_xact_commit{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n+\nrate(pg_stat_database_xact_rollback{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: TPS",
               "refId": "Transactions per second"
            }
         ],
         "title": "Transactions per second",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "description": "Row-level activity showing reads (fetched/returned) and writes (inserted/updated/deleted).",
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 30,
                  "gradientMode": "opacity",
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "showPoints": "never"
               },
               "unit": "rows/s"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Rows fetched"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "rows/s"
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Rows returned"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "rows/s"
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Rows inserted"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "rows/s"
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Rows updated"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "rows/s"
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Rows deleted"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "rows/s"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 37
         },
         "options": {
            "legend": {
               "calcs": [ ],
               "displayMode": "list"
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_database_tup_fetched{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Fetched",
               "refId": "Rows fetched"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_database_tup_returned{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Returned",
               "refId": "Rows returned"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_database_tup_inserted{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Inserted",
               "refId": "Rows inserted"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_database_tup_updated{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Updated",
               "refId": "Rows updated"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_database_tup_deleted{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Deleted",
               "refId": "Rows deleted"
            }
         ],
         "title": "Rows Activity",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Percentage of max_connections in use. Above 80% is warning, above 95% is critical.",
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 30,
                  "gradientMode": "opacity",
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "showPoints": "never",
                  "thresholdsStyle": {
                     "mode": "line"
                  }
               },
               "max": 1,
               "min": 0,
               "thresholds": {
                  "steps": [
                     {
                        "color": "yellow",
                        "value": 0.80000000000000004
                     },
                     {
                        "color": "red",
                        "value": 0.94999999999999996
                     }
                  ]
               },
               "unit": "percentunit"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Connection utilization"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "percentunit"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 45
         },
         "options": {
            "legend": {
               "calcs": [ ],
               "displayMode": "list"
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  sum by (job,cluster,instance) (pg_stat_activity_count{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n/\nmax by (job,cluster,instance) (pg_settings_max_connections{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Connection utilization",
               "refId": "Connection utilization"
            }
         ],
         "title": "Connection utilization",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Cache hit ratio over time. Should stay above 95%.",
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 30,
                  "gradientMode": "opacity",
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "showPoints": "never",
                  "thresholdsStyle": {
                     "mode": "line"
                  }
               },
               "max": 1,
               "min": 0,
               "thresholds": {
                  "steps": [
                     {
                        "color": "red",
                        "value": 0
                     },
                     {
                        "color": "orange",
                        "value": 0.80000000000000004
                     },
                     {
                        "color": "yellow",
                        "value": 0.90000000000000002
                     },
                     {
                        "color": "green",
                        "value": 0.94999999999999996
                     }
                  ]
               },
               "unit": "percentunit"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Cache hit ratio"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "percentunit"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 45
         },
         "options": {
            "legend": {
               "calcs": [ ],
               "displayMode": "list"
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  sum by (job,cluster,instance) (pg_stat_database_blks_hit{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n/\n(\n  sum by (job,cluster,instance) (pg_stat_database_blks_hit{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n  +\n  sum by (job,cluster,instance) (pg_stat_database_blks_read{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n)\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Cache hit ratio",
               "refId": "Cache hit ratio"
            }
         ],
         "title": "Cache hit ratio",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "description": "Buffer pool activity: allocations, cleaned by bgwriter, and max written stops (I/O pressure indicator).",
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 30,
                  "gradientMode": "opacity",
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "showPoints": "never"
               },
               "unit": "ops"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Buffers alloc"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "ops"
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Buffers cleaned"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "ops"
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Buffers clean total"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "ops"
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Max written stops"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "ops"
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Stats age"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "s"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 53
         },
         "options": {
            "legend": {
               "calcs": [ ],
               "displayMode": "list"
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_bgwriter_buffers_alloc_total{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Allocated",
               "refId": "Buffers alloc"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_bgwriter_buffers_clean_total{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Cleaned",
               "refId": "Buffers cleaned"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_bgwriter_buffers_clean_total{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Clean total",
               "refId": "Buffers clean total"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_bgwriter_maxwritten_clean_total{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Max written stops",
               "refId": "Max written stops"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  time() - pg_stat_bgwriter_stats_reset_total{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Stats age",
               "refId": "Stats age"
            }
         ],
         "title": "Buffers Activity",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Blocks read from disk (not cache). Spikes indicate cache misses.",
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 30,
                  "gradientMode": "opacity",
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "showPoints": "never"
               },
               "unit": "ops"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Disk reads"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "ops"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 53
         },
         "options": {
            "legend": {
               "calcs": [ ],
               "displayMode": "list"
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_database_blks_read{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Disk reads",
               "refId": "Disk reads"
            }
         ],
         "title": "Disk reads",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Bytes written to temp files. High values indicate work_mem is too small.",
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 30,
                  "gradientMode": "opacity",
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "showPoints": "never"
               },
               "unit": "bytes"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Temp bytes written"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "bytes"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 61
         },
         "options": {
            "legend": {
               "calcs": [ ],
               "displayMode": "list"
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_database_temp_bytes{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Temp bytes",
               "refId": "Temp bytes written"
            }
         ],
         "title": "Temp bytes written",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Rate of new buffer allocations per second. High values indicate memory pressure.",
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 30,
                  "gradientMode": "opacity",
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "showPoints": "never"
               },
               "unit": "ops"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Buffers allocated"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "ops"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 61
         },
         "options": {
            "legend": {
               "calcs": [ ],
               "displayMode": "list"
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  rate(pg_stat_bgwriter_buffers_alloc_total{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}[$__rate_interval])\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Buffers allocated",
               "refId": "Buffers allocated"
            }
         ],
         "title": "Buffers allocated",
         "type": "timeseries"
      },
      {
         "collapsed": false,
         "gridPos": {
            "h": 1,
            "w": 0,
            "x": 0,
            "y": 69
         },
         "panels": [ ],
         "title": "Maintenance",
         "type": "row"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Ratio of tables with > 10% dead tuples. Run VACUUM on these tables.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 0.050000000000000003
                     },
                     {
                        "color": "orange",
                        "value": 0.10000000000000001
                     },
                     {
                        "color": "red",
                        "value": 0.20000000000000001
                     }
                  ]
               },
               "unit": "percentunit"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Tables needing vacuum ratio"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "percentunit"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 4,
            "x": 0,
            "y": 70
         },
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "avg by (job,cluster,instance) (\n  count(\n  (\n    pg_stat_user_tables_n_dead_tup{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n    /\n    (pg_stat_user_tables_n_live_tup{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"} + pg_stat_user_tables_n_dead_tup{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"} + 1)\n  ) > 0.1\n)\n/\ncount(pg_stat_user_tables_n_live_tup{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Tables needing vacuum",
               "refId": "Tables needing vacuum ratio"
            }
         ],
         "title": "Tables needing vacuum ratio",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Time since oldest table was vacuumed. > 7 days is warning.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "fixed"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 604800
                     },
                     {
                        "color": "red",
                        "value": 1209600
                     }
                  ]
               },
               "unit": "s"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Oldest vacuum age"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "s"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 4,
            "x": 4,
            "y": 70
         },
         "options": {
            "colorMode": "fixed",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "max by (job,cluster,instance) (\n  (time() - pg_stat_user_tables_last_autovacuum{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\nand\npg_stat_user_tables_last_autovacuum{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"} > 0\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Oldest vacuum",
               "refId": "Oldest vacuum age"
            }
         ],
         "title": "Oldest vacuum age",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Ratio of seq scans to total. High values indicate missing indexes.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 0.20000000000000001
                     },
                     {
                        "color": "orange",
                        "value": 0.40000000000000002
                     },
                     {
                        "color": "red",
                        "value": 0.59999999999999998
                     }
                  ]
               },
               "unit": "percentunit"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Sequential scan ratio"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "percentunit"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 4,
            "x": 8,
            "y": 70
         },
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "avg by (job,cluster,instance) (\n  sum(pg_stat_user_tables_seq_scan{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n/\n(\n  sum(pg_stat_user_tables_seq_scan{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n  +\n  sum(pg_stat_user_tables_idx_scan{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"})\n  + 1\n)\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Seq scan ratio",
               "refId": "Sequential scan ratio"
            }
         ],
         "title": "Sequential scan ratio",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Indexes with zero scans. Candidates for removal.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "fixed"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 5
                     },
                     {
                        "color": "orange",
                        "value": 10
                     }
                  ]
               }
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Unused indexes"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "short"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 4,
            "x": 12,
            "y": 70
         },
         "options": {
            "colorMode": "fixed",
            "graphMode": "none",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "count by (job,cluster,instance) (\n  (pg_statio_user_indexes_idx_blks_hit_total{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"} == 0)\nand\n(pg_statio_user_indexes_idx_blks_read_total{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"} == 0)\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Unused indexes",
               "refId": "Unused indexes"
            }
         ],
         "title": "Unused indexes",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Total size of all databases.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "fixed"
               },
               "unit": "bytes"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Database size"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "bytes"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 4,
            "x": 16,
            "y": 70
         },
         "options": {
            "colorMode": "fixed",
            "graphMode": "area",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  pg_database_size_bytes{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Database size",
               "refId": "Database size"
            }
         ],
         "title": "Database size",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Current WAL LSN position in bytes (total WAL written).",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "text",
                  "mode": "fixed"
               },
               "unit": "bytes"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "WAL position"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "bytes"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 4,
            "x": 20,
            "y": 70
         },
         "options": {
            "colorMode": "fixed",
            "graphMode": "area",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ]
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "max by (job,cluster,instance) (\n  pg_stat_replication_pg_current_wal_lsn_bytes{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\nor vector(0)\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: WAL position",
               "refId": "WAL position"
            }
         ],
         "title": "WAL position",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Dead tuple ratio per table. > 10% needs VACUUM.",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "mode": "thresholds"
               },
               "custom": {
                  "fillOpacity": 30,
                  "gradientMode": "opacity",
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "showPoints": "never",
                  "thresholdsStyle": {
                     "mode": "line"
                  }
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": 0
                     },
                     {
                        "color": "yellow",
                        "value": 0.050000000000000003
                     },
                     {
                        "color": "orange",
                        "value": 0.10000000000000001
                     },
                     {
                        "color": "red",
                        "value": 0.20000000000000001
                     }
                  ]
               },
               "unit": "percentunit"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Dead tuple ratio"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "percentunit"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 78
         },
         "options": {
            "legend": {
               "calcs": [ ],
               "displayMode": "list"
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance,schemaname,relname) (\n  (\n  pg_stat_user_tables_n_dead_tup{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n  /\n  (pg_stat_user_tables_n_live_tup{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"} + pg_stat_user_tables_n_dead_tup{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"} + 1)\n)\n\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: {{ schemaname }}.{{ relname }}",
               "refId": "Dead tuple ratio"
            }
         ],
         "title": "Dead tuple ratio",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "description": "Tables with dead tuple ratio and time since last vacuum. Sort by dead tuple ratio to find tables needing VACUUM.",
         "fieldConfig": {
            "overrides": [
               {
                  "matcher": {
                     "id": "byName",
                     "options": "Dead Tuple Ratio"
                  },
                  "properties": [
                     {
                        "id": "color",
                        "value": {
                           "mode": "thresholds"
                        }
                     },
                     {
                        "id": "thresholds",
                        "value": {
                           "steps": [
                              {
                                 "color": "green",
                                 "value": 0
                              },
                              {
                                 "color": "yellow",
                                 "value": 0.050000000000000003
                              },
                              {
                                 "color": "orange",
                                 "value": 0.10000000000000001
                              },
                              {
                                 "color": "red",
                                 "value": 0.20000000000000001
                              }
                           ]
                        }
                     },
                     {
                        "id": "unit",
                        "value": "percentunit"
                     },
                     {
                        "id": "custom.cellOptions",
                        "value": {
                           "type": "color-text"
                        }
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byName",
                     "options": "Last Vacuum Age"
                  },
                  "properties": [
                     {
                        "id": "color",
                        "value": {
                           "mode": "thresholds"
                        }
                     },
                     {
                        "id": "mappings",
                        "value": [
                           {
                              "options": {
                                 "match": "null",
                                 "result": {
                                    "color": "red",
                                    "text": "Never"
                                 }
                              },
                              "type": "special"
                           },
                           {
                              "options": {
                                 "match": "nan",
                                 "result": {
                                    "color": "red",
                                    "text": "Never"
                                 }
                              },
                              "type": "special"
                           }
                        ]
                     },
                     {
                        "id": "thresholds",
                        "value": {
                           "steps": [
                              {
                                 "color": "green",
                                 "value": 0
                              },
                              {
                                 "color": "yellow",
                                 "value": 86400
                              },
                              {
                                 "color": "red",
                                 "value": 604800
                              }
                           ]
                        }
                     },
                     {
                        "id": "unit",
                        "value": "dtdhms"
                     },
                     {
                        "id": "custom.cellOptions",
                        "value": {
                           "type": "color-text"
                        }
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 78
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance,schemaname,relname) (\n  (\n  pg_stat_user_tables_n_dead_tup{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n  /\n  (pg_stat_user_tables_n_live_tup{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"} + pg_stat_user_tables_n_dead_tup{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"} + 1)\n)\n\n)",
               "format": "table",
               "instant": true,
               "legendFormat": "{{cluster}} - {{instance}}: {{ schemaname }}.{{ relname }}",
               "refId": "Dead tuple ratio"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance,schemaname,relname) (\n  (\n  time() - pg_stat_user_tables_last_autovacuum{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n)\nand\npg_stat_user_tables_last_autovacuum{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"} > 0\n\n)",
               "format": "table",
               "instant": true,
               "legendFormat": "{{cluster}} - {{instance}}: {{ schemaname }}.{{ relname }}",
               "refId": "Last vacuum age"
            }
         ],
         "title": "Table Vacuum Status",
         "transformations": [
            {
               "id": "merge"
            },
            {
               "id": "filterFieldsByName",
               "options": {
                  "include": {
                     "pattern": "^(?!Time).*$"
                  }
               }
            },
            {
               "id": "organize",
               "options": {
                  "renameByName": {
                     "Value #Dead tuple ratio": "Dead Tuple Ratio",
                     "Value #Last vacuum age": "Last Vacuum Age",
                     "instance": "Instance",
                     "job": "Job",
                     "relname": "Table",
                     "schemaname": "Schema"
                  }
               }
            },
            {
               "id": "sortBy",
               "options": {
                  "fields": { },
                  "sort": [
                     {
                        "desc": true,
                        "field": "Dead Tuple Ratio"
                     }
                  ]
               }
            }
         ],
         "type": "table"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "description": "Indexes with zero buffer hits and disk reads since stats reset. Candidates for removal to save disk space.",
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 86
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "(\n  (pg_statio_user_indexes_idx_blks_hit_total{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"} == 0)\n  and\n  (pg_statio_user_indexes_idx_blks_read_total{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"} == 0)\n)\n",
               "format": "table",
               "instant": true,
               "refId": "UnusedIndexes"
            }
         ],
         "title": "Unused Indexes",
         "transformations": [
            {
               "id": "filterFieldsByName",
               "options": {
                  "include": {
                     "names": [
                        "cluster",
                        "instance",
                        "job",
                        "schemaname",
                        "relname",
                        "indexrelname"
                     ]
                  }
               }
            },
            {
               "id": "organize",
               "options": {
                  "indexByName": {
                     "cluster": 0,
                     "indexrelname": 5,
                     "instance": 1,
                     "job": 2,
                     "relname": 4,
                     "schemaname": 3
                  },
                  "renameByName": {
                     "cluster": "Cluster",
                     "indexrelname": "Index",
                     "instance": "Instance",
                     "job": "Job",
                     "relname": "Table",
                     "schemaname": "Schema"
                  }
               }
            },
            {
               "id": "sortBy",
               "options": {
                  "fields": { },
                  "sort": [
                     {
                        "desc": false,
                        "field": "Index"
                     }
                  ]
               }
            }
         ],
         "type": "table"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Total size of all databases.",
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 30,
                  "gradientMode": "opacity",
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "showPoints": "never"
               },
               "unit": "bytes"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byFrameRefID",
                     "options": "Database size"
                  },
                  "properties": [
                     {
                        "id": "unit",
                        "value": "bytes"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 86
         },
         "options": {
            "legend": {
               "calcs": [ ],
               "displayMode": "list"
            },
            "tooltip": {
               "mode": "multi",
               "sort": "desc"
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "sum by (job,cluster,instance) (\n  pg_database_size_bytes{job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}\n)",
               "format": "time_series",
               "instant": false,
               "legendFormat": "{{cluster}} - {{instance}}: Database size",
               "refId": "Database size"
            }
         ],
         "title": "Database size",
         "type": "timeseries"
      },
      {
         "collapsed": false,
         "gridPos": {
            "h": 1,
            "w": 0,
            "x": 0,
            "y": 94
         },
         "panels": [ ],
         "title": "PostgreSQL Settings",
         "type": "row"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "description": "PostgreSQL configuration settings. Use the Settings Filter variable above to search by setting name (regex). Default .* shows all settings.",
         "fieldConfig": {
            "overrides": [
               {
                  "matcher": {
                     "id": "byName",
                     "options": "Setting"
                  },
                  "properties": [
                     {
                        "id": "custom.filterable",
                        "value": true
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byName",
                     "options": "Job"
                  },
                  "properties": [
                     {
                        "id": "custom.width",
                        "value": 150
                     },
                     {
                        "id": "custom.filterable",
                        "value": true
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byName",
                     "options": "Cluster"
                  },
                  "properties": [
                     {
                        "id": "custom.width",
                        "value": 150
                     },
                     {
                        "id": "custom.filterable",
                        "value": true
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byName",
                     "options": "Instance"
                  },
                  "properties": [
                     {
                        "id": "custom.filterable",
                        "value": true
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byName",
                     "options": "Value"
                  },
                  "properties": [
                     {
                        "id": "custom.width",
                        "value": 200
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 16,
            "w": 24,
            "x": 0,
            "y": 95
         },
         "options": {
            "footer": {
               "enablePagination": true
            },
            "showHeader": true,
            "sortBy": [
               {
                  "desc": false,
                  "displayName": "Setting"
               }
            ]
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "expr": "{__name__=~\"pg_settings_.*${settingsFilter}.*\",job=~\"$job\",cluster=~\"$cluster\",instance=~\"$instance\"}",
               "format": "table",
               "instant": true,
               "refId": "Settings"
            }
         ],
         "title": "PostgreSQL Settings",
         "transformations": [
            {
               "id": "organize",
               "options": {
                  "excludeByName": {
                     "Time": true,
                     "__name__": false,
                     "cluster": false,
                     "environment": true,
                     "instance": false,
                     "job": false,
                     "server": true,
                     "server_id": true
                  },
                  "indexByName": {
                     "Value": 1,
                     "__name__": 0,
                     "cluster": 2,
                     "instance": 3,
                     "job": 4
                  },
                  "renameByName": {
                     "Value": "Value",
                     "__name__": "Setting",
                     "cluster": "Cluster",
                     "instance": "Instance",
                     "job": "Job"
                  }
               }
            },
            {
               "id": "sortBy",
               "options": {
                  "fields": { },
                  "sort": [
                     {
                        "desc": false,
                        "field": "Setting"
                     }
                  ]
               }
            }
         ],
         "type": "table"
      }
   ],
   "schemaVersion": 39,
   "tags": [
      "postgres",
      "database"
   ],
   "templating": {
      "list": [
         {
            "label": "Data source",
            "name": "datasource",
            "query": "prometheus",
            "regex": "",
            "type": "datasource"
         },
         {
            "allValue": ".+",
            "datasource": {
               "type": "prometheus",
               "uid": "${datasource}"
            },
            "includeAll": true,
            "label": "Job",
            "multi": true,
            "name": "job",
            "query": "label_values({__name__=~\"pg_up\"}, job)",
            "refresh": 2,
            "sort": 1,
            "type": "query"
         },
         {
            "allValue": ".+",
            "datasource": {
               "type": "prometheus",
               "uid": "${datasource}"
            },
            "includeAll": true,
            "label": "Cluster",
            "multi": true,
            "name": "cluster",
            "query": "label_values({__name__=~\"pg_up\",job=~\"$job\"}, cluster)",
            "refresh": 2,
            "sort": 1,
            "type": "query"
         },
         {
            "allValue": ".+",
            "datasource": {
               "type": "prometheus",
               "uid": "${datasource}"
            },
            "includeAll": true,
            "label": "Instance",
            "multi": true,
            "name": "instance",
            "query": "label_values({__name__=~\"pg_up\",job=~\"$job\",cluster=~\"$cluster\"}, instance)",
            "refresh": 2,
            "sort": 1,
            "type": "query"
         },
         {
            "current": {
               "selected": false,
               "text": "",
               "value": ""
            },
            "description": "Regex pattern to filter pg_settings_* metrics. Leave empty to show all settings.",
            "label": "Settings Filter (regex)",
            "name": "settingsFilter",
            "options": [
               {
                  "selected": true,
                  "text": "",
                  "value": ""
               }
            ],
            "query": "",
            "type": "textbox"
         }
      ]
   },
   "time": {
      "from": "now-6h",
      "to": "now"
   },
   "timezone": "utc",
   "title": "PostgreSQL Overview",
   "uid": "postgres-overview"
}
