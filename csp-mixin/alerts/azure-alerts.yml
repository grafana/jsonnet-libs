groups:
  - name: azure
    rules:
      - alert: AzureVMHighCpuUtilization
        expr: |
          avg by (job,resourceGroup,subscriptionName,resourceName) (azure_microsoft_compute_virtualmachines_percentage_cpu_average_percent{job=~".+",resourceGroup=~".+",subscriptionName=~".+",resourceName=~".+"})  > 85
        for: 5m
        keep_firing_for: 10m
        labels:
          severity: critical
          service: 'Azure Virtual Machines'
          namespace: cloud-provider-azure
        annotations:
          summary: 'CPU utilization is too high.'
          description: 'The VM {{ $labels.resourceName }} is under heavy load and may become unresponsive.'
          dashboard_uid: '58f33c50e66c911b0ad8a25aa438a96e'

      - alert: AzureVMUnavailable
        expr: |
          avg by (job,resourceGroup,subscriptionName,resourceName) (azure_microsoft_compute_virtualmachines_vmavailabilitymetric_average_count{job=~".+",resourceGroup=~".+",subscriptionName=~".+",resourceName=~".+"}) != 1
        for: 5m
        keep_firing_for: 10m
        labels:
          severity: critical
          service: 'Azure Virtual Machines.'
          namespace: cloud-provider-azure
        annotations:
          summary: 'VM unavailable.'
          description: 'The VM {{ $labels.resourceName }} is not functioning or crashed, which may require immediate action.'
          dashboard_uid: '58f33c50e66c911b0ad8a25aa438a96e'
